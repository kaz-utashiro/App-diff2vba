DOCX  = $(wildcard *.docx)
NAME  = $(basename $(DOCX))

DIFF  = $(NAME:=.diff)
DIFF += $(NAME:=.small-diff)
STAT  = $(NAME:=.stat)

PATCH  = $(NAME:=.patch)
PATCH += $(NAME:=.small-patch)
PATCH += $(NAME:=.dumb-patch)
PATCH += $(NAME:=.pretty-patch)
PATCH += $(NAME:=.small-pretty-patch)
PATCH += $(NAME:=.small-dumb-patch)

ALL = $(DIFF) $(STAT) $(PATCH)

all: $(ALL)

$(ALL): Makefile

clean:
	rm -f $(ALL)

GREPLE = greple -Mmsdoc -Msubst --check=any
DIFF2VBA = perl -I../lib ../script/diff2vba

%.diff: %.docx
	$(GREPLE) --all-sample-dict --diff $< | sed 1,2d > $@

%.small-diff: %.docx
	$(GREPLE) --dictdata $$'コンピューター? コンピューター' --diff $< | sed 1,2d > $@


%.stat: %.docx
	$(GREPLE) --all-sample-dict --stat $< > $@


%.patch: %.diff
	$(DIFF2VBA) --no-pretty $< > $@

%.pretty-patch: %.diff
	$(DIFF2VBA) --pretty $< > $@

%.small-patch: %.small-diff
	$(DIFF2VBA) --no-pretty $< > $@

%.small-pretty-patch: %.small-diff
	$(DIFF2VBA) --pretty $< > $@

%.dumb-patch: %.diff
	$(DIFF2VBA) --no-pretty --format=dumb $< > $@

%.small-dumb-patch: %.small-diff
	$(DIFF2VBA) --no-pretty --format=dumb $< > $@

